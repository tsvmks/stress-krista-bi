# Пример с запуском через mvn

1. Выполнить поиск точки деградации производительности
2. Выполнить подтверждающий тест стабильности


Полезные команды:

Запуск теста в графическом режиме
```
mvn jmeter:configure jmeter:gui
```

Запуск нагрузочного теста:
```
mvn clean verify -P MaxPerf
```

Запуск теста стабильности:
```
mvn clean verify -P Stable
```

Полезные ссылки:

На выданном тесте можно смотреть результаты выполнения в системах мониторинга

* http://metrics.loadlab.ragozin.info:3000/d/JMeter - просмотр результатов теста
* http://metrics.loadlab.ragozin.info:3000/d/jmeterCompare - сравнение результатов двух тестов

# MaxPerf

Цель:

- запустить тест
- найти точку деградации производительности

#### Расчет профиля нагрузки

Изначально нам максимум для нашего сервиса не известен, поэтому нагрузка задана согласно параметрам

    <id>MaxPerf</id>
    <properties>
        <isMaxPerf>1</isMaxPerf>
        <duration>300</duration>
        <tps>0.1</tps>
        <thread_count>250</thread_count>
        <title>MaxPerf</title>
    </properties>

Будет создаваться 250 потоков, каждый из которых выполняет по 0.1 транзакции в секунду.
То есть задан шаг нагрзки для одного клиента равный 10 секундам, за это время транзакция должна отработать полностью.
То есть точка деградации производительности ищется на интенсивности от 0 до 25 транзакций в сек.

Если такой профиль окажется слишком мал или слишком велик для вашего стенда, то его можно скорректировать.
Сделав потоков меньше или побольше.

#### Запустить тест поиска максимальной производительности

```
 mvn clean verify -P MaxPerf
```

Тест будет выполняться **5 минут**.
За результатами теста можно следить online: http://metrics.loadlab.ragozin.info:3000/d/JMeter

#### Находим
1. Точку деградации производительности.
2. Точку появления ошибок.
(возможно точки совпадают)

#### Определяем максимальную интенсивность как:

3. Сценарии в сек
4. Сценарии в час

Примерно на 50 пользователях и 5 tps мой сервак упал :( 
![MaxPerf](https://github.com/tsvmks/stress-krista-bi/blob/main/JMeterMVN/src/test/jmeter/res.png)

# Stable

#### Расчет профиля нагрузки

Расчитать интенсивность, на которой будет проводиться тест стабильности, как 80% от теста максимальной производительности

Например, пусть она получилась равная 0.8 * 5 = 4

#### Запустить тест стабильности

```
 mvn clean verify -P Stable -Dtps=4
```

Тест будет выполняться **10 минут**.
За результатами теста можно следить online: http://metrics.loadlab.ragozin.info:3000/d/JMeter

#### Анализ результатов теста

Убедиться, что

1. Нет точки деградации производительности
2. Нет точки появления ошибок в ответах сервера
3. Нет ошибок в логе JMeter
